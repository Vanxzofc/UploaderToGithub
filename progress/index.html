<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>GitHub Uploader</title>
  <style>
    * { box-sizing: border-box; }
    body, html {
      margin: 0; padding: 0; height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white; overflow: hidden;
    }
    video.bg-video {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      object-fit: cover; z-index: -1;
    }
    .container {
      background: rgba(0, 0, 0, 0.65);
      border-radius: 16px;
      padding: 1.5rem;
      max-width: 340px;
      margin: 7vh auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
    }
    h1 { text-align: center; margin-bottom: 1.3rem; font-size: 1.6rem; }
    input, select {
      width: 100%; padding: 8px; margin: 8px 0;
      border-radius: 15px; border: none; font-size: 0.9rem;
    }
    button {
      padding: 7px; width: 100%; background-color: #2ea44f;
      border: none; color: white; font-weight: bold;
      border-radius: 15px; margin-top: 10px;
      cursor: pointer; transition: background 0.3s;
    }
    button:hover { background-color: #24913d; }
    button.cancel { background-color: #6c757d; font-size: 0.8rem; padding: 7px 10px; }
    .info-tooltip { font-size: 0.8rem; margin: 5px 0 10px; color: #bbb; }
    .footer-bubble {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.08); padding: 6px 14px;
      font-size: 0.75rem; border-radius: 20px; color: #ccc;
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(6px); z-index: 10;
    }
    .loader {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      border: 6px solid rgba(255, 255, 255, 0.1);
      border-top: 6px solid #58a6ff;
      border-radius: 50%;
      width: 40px; height: 40px;
      animation: spin 1s linear infinite;
      z-index: 1000;
    }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
    .token-wrap { display: flex; gap: 6px; }
    .token-wrap input { flex: 1; }
    .token-wrap button { flex: 0 0 auto; width: auto; padding: 6px 12px; font-size: 0.8rem; background: #007bff; }
    .token-wrap button:hover { background: #0062cc; }
  </style>
</head>
<body oncontextmenu="return false">
  <video autoplay muted loop class="bg-video">
    <source src="https://files.catbox.moe/bhywce.mp4" type="video/mp4" />
  </video>

  <div class="container">
    <h1>ðŸ§© GitHub Uploader</h1>
    <form id="uploadForm">
      <input type="text" id="username" placeholder="GitHub Username" required />
      <input type="text" id="repo" placeholder="Repository Name" required />

      <!-- Wrap token + paste -->
      <div class="token-wrap">
        <input type="password" id="token" placeholder="GitHub Token" required />
        <button type="button" id="pasteToken">Paste</button>
      </div>

      <select id="visibility" onclick="showInfo()">
        <option value="public">Public</option>
        <option value="private">Private</option>
      </select>
      <div id="infoText" class="info-tooltip" style="display: none;">
        <strong>Public</strong>: Semua orang bisa lihat repo ini.<br>
        <strong>Private</strong>: Hanya kamu yang bisa lihat repo.
      </div>
      
      <input type="file" id="fileInput" />
      <input type="url" id="fileUrl" placeholder="Atau masukkan Link File (URL)" />

      <button type="submit">Upload to GitHub</button>
      <button type="button" class="cancel" onclick="resetForm()">Cancel</button>
    </form>
  </div>
  
  <div class="footer-bubble">Powered By Vanz Ryuichi ðŸ”–</div>
  <div class="loader" id="loader" style="display:none;"></div>

  <script>	
  document.addEventListener('keydown', function (e) {
    if (
      e.keyCode === 123 ||
      (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
      (e.ctrlKey && e.keyCode === 85)
    ) {
      e.preventDefault();
      return false;
    }
  });

  function showInfo() {
    document.getElementById('infoText').style.display = 'block';
  }

  function resetForm() {
    document.getElementById('uploadForm').reset();
    document.getElementById('infoText').style.display = 'none';
  }

  // Tombol paste untuk token
  document.getElementById('pasteToken').addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();
      if (!text) return alert("Clipboard kosong!");
      document.getElementById('token').value = text.trim();
    } catch (err) {
      alert("Gagal membaca clipboard: " + err.message);
    }
  });

  async function extractZip(file) {
    const JSZip = await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm');
    const zip = await JSZip.default.loadAsync(file);
    const files = [];
    for (const filename of Object.keys(zip.files)) {
      if (zip.files[filename].dir) continue; // skip folder
      const content = await zip.files[filename].async("base64");
      files.push({ path: filename, content });
    }
    return files;
  }

  document.getElementById('uploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    document.getElementById('loader').style.display = 'block';
    document.querySelectorAll('button').forEach(btn => btn.disabled = true);

    const username = document.getElementById('username').value.trim();
    const repo = document.getElementById('repo').value.trim();
    const token = document.getElementById('token').value.trim();
    const fileInputEl = document.getElementById('fileInput');
    const fileInput = fileInputEl.files[0];
    const fileUrl = document.getElementById('fileUrl').value.trim();

    let files = [];

    try {
      if (fileInput) {
        // ðŸ”’ Batas GitHub API: 100MB per file
        if (fileInput.size > 104857600) {
          throw new Error("File melebihi 100 MB. Gunakan Git LFS untuk file besar.");
        }

        if (fileInput.name.endsWith(".zip")) {
          files = await extractZip(fileInput);
        } else {
          const content = await fileInput.arrayBuffer();
          const base64 = btoa(String.fromCharCode(...new Uint8Array(content)));
          files.push({ path: fileInput.name, content: base64 });
        }
      } else if (fileUrl) {
        const res = await fetch(fileUrl);
        if (!res.ok) throw new Error("Gagal download file dari URL");
        const blob = await res.blob();

        // ðŸ”’ Batas GitHub API: 100MB per file dari URL juga dicek
        if (blob.size > 104857600) {
          throw new Error("File dari URL melebihi 100 MB. Gunakan Git LFS untuk file besar.");
        }

        if (fileUrl.endsWith(".zip")) {
          files = await extractZip(blob);
        } else {
          const arrayBuffer = await blob.arrayBuffer();
          const base64 = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
          const filename = fileUrl.split("/").pop();
          files.push({ path: filename, content: base64 });
        }
      } else {
        alert("Silakan pilih file atau masukkan link URL");
        return;
      }

      localStorage.setItem("gh_upload_data", JSON.stringify({ username, repo, token, files }));
      window.location.href = "progress/index.html";

    } catch (err) {
      alert("Error: " + err.message);
      document.getElementById('loader').style.display = 'none';
      document.querySelectorAll('button').forEach(btn => btn.disabled = false);
    }
  });
  </script>
</body>
</html>